# Toy News - ç»Ÿä¸€æ•°æ®å½’ä¸€åŒ–ä¸ç¿»è¯‘ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Scrapy çš„ç©å…·èµ„è®¯çˆ¬å–ä¸ç¿»è¯‘ç³»ç»Ÿï¼Œæ”¯æŒæ•°æ®å½’ä¸€åŒ–ã€æ™ºèƒ½å»é‡å’Œç¼“å­˜ç¿»è¯‘ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              TOY NEWS æ•°æ®å¤„ç†æ¶æ„                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çˆ¬è™«å±‚     â”‚    â”‚   æ•°æ®å¤„ç†   â”‚    â”‚   å­˜å‚¨å±‚     â”‚    â”‚   ç¿»è¯‘å±‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚JumpCal Spiderâ”‚    â”‚DataValidationâ”‚    
â”‚BSP Prize    â”‚â”€â”€â”€â–¶â”‚DataQuality  â”‚    
â”‚Spider       â”‚    â”‚Pipeline     â”‚    
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
                           â”‚                           
                           â–¼                           
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚åŸå§‹æ•°æ®å­˜å‚¨  â”‚    â”‚å½’ä¸€åŒ–å¤„ç†    â”‚
                   â”‚Pipeline     â”‚â”€â”€â”€â–¶â”‚Pipeline     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚
                           â–¼                   â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚åŸå§‹æ•°æ®é›†åˆ  â”‚    â”‚å½’ä¸€åŒ–æ•°æ®    â”‚
                   â”‚jump_cal_*   â”‚    â”‚toys_        â”‚
                   â”‚bsp_prize_*  â”‚    â”‚normalized   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ç¿»è¯‘Pipeline â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚translation_ â”‚
                                     â”‚pending      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â–¼
                   â”‚translation_ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚cache        â”‚â—€â”€â”€â”€â”‚Translation  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚Service      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ç¿»è¯‘ç»“æœæ›´æ–°  â”‚
                                     â”‚è‡³toys_      â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æµå‘ï¼š
åŸå§‹çˆ¬å– â†’ æ•°æ®éªŒè¯ â†’ åŸå§‹å­˜å‚¨ â†’ æ•°æ®å½’ä¸€åŒ– â†’ ç¿»è¯‘å¤„ç† â†’ ç¼“å­˜ä¼˜åŒ–
```

## ğŸ“Š æ•°æ®å­˜å‚¨ç»“æ„

```
MongoDB Collections:
â”œâ”€â”€ åŸå§‹æ•°æ®å±‚
â”‚   â”œâ”€â”€ jump_cal_op          # ONEPIECE å•†å“æ•°æ®
â”‚   â”œâ”€â”€ jump_cal_hunter      # HunterÃ—Hunter å•†å“æ•°æ®  
â”‚   â”œâ”€â”€ bsp_prize_op         # BSP Prize æ•°æ®
â”‚   â””â”€â”€ ...                  # å…¶ä»–åŸå§‹æ•°æ®é›†åˆ
â”‚
â”œâ”€â”€ å½’ä¸€åŒ–æ•°æ®å±‚  
â”‚   â””â”€â”€ toys_normalized  # ç»Ÿä¸€å•†å“æ•°æ®ç»“æ„
â”‚       â”œâ”€â”€ product_hash     # å•†å“å“ˆå¸ŒID (å»é‡æ ‡è¯†)
â”‚       â”œâ”€â”€ name            # å•†å“åç§°
â”‚       â”œâ”€â”€ description     # å•†å“æè¿°  
â”‚       â”œâ”€â”€ nameCN          # ä¸­æ–‡å•†å“åç§° (ç¿»è¯‘ç»“æœ)
â”‚       â”œâ”€â”€ descriptionCN   # ä¸­æ–‡æè¿° (ç¿»è¯‘ç»“æœ)
â”‚       â””â”€â”€ ...             # å…¶ä»–å½’ä¸€åŒ–å­—æ®µ
â”‚
â””â”€â”€ ç¿»è¯‘ç®¡ç†å±‚
    â”œâ”€â”€ translation_pending  # å¾…ç¿»è¯‘é˜Ÿåˆ—
    â””â”€â”€ translation_cache    # ç¿»è¯‘ç»“æœç¼“å­˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository>
cd toy_news

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export DEEPSEEK_API_KEY="your_api_key"
export MONGO_URI="mongodb://localhost:27017/"
export MONGO_DATABASE="scrapy_items"
```

### 2. è¿è¡Œçˆ¬è™«

```bash
# çˆ¬å– ONEPIECE å•†å“æ•°æ®
scrapy crawl jump_cal_op

# çˆ¬å– HunterÃ—Hunter å•†å“æ•°æ®  
scrapy crawl jump_cal_hunter

# çˆ¬å– BSP Prize æ•°æ®
scrapy crawl bsp_prize_op
```

### 3. å¯åŠ¨ç¿»è¯‘æœåŠ¡

```bash
# å¯åŠ¨ç»Ÿä¸€ç¿»è¯‘æœåŠ¡
python scripts/translation_service.py

# æŸ¥çœ‹ç¿»è¯‘ç»Ÿè®¡
python scripts/translation_service.py --show-stats

# è‡ªå®šä¹‰æ£€æŸ¥é—´éš”
python scripts/translation_service.py --interval 30
```

## ğŸ“‹ Pipeline é…ç½®

ç³»ç»Ÿä½¿ç”¨åˆ†å±‚ Pipeline æ¶æ„ï¼š

```python
ITEM_PIPELINES = {
    # 1. æ•°æ®éªŒè¯å’Œæ¸…æ´— (100-200)
    'toy_news.pipelines.normalization.DataValidationPipeline': 100,
    'toy_news.pipelines.normalization.DataQualityPipeline': 200,
    
    # 2. æ–‡ä»¶ä¸‹è½½ (300)
    'toy_news.pipelines.files.ToyNewsFilesPipeline': 300,
    
    # 3. åŸå§‹æ•°æ®å­˜å‚¨ (400-700)
    'toy_news.pipelines.jump_cal.PurifyPipeline': 600,
    'toy_news.pipelines.jump_cal.JumpCalMongoPipeline': 700,
    
    # 4. æ•°æ®å½’ä¸€åŒ– (800)
    'toy_news.pipelines.normalization.DataNormalizationPipeline': 800,
    
    # 5. ç¿»è¯‘æœåŠ¡ (950)
    'toy_news.pipelines.translation.TranslationPipeline': 950,
}
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### æ•°æ®å½’ä¸€åŒ–

å°†ä¸åŒæ•°æ®æºçš„å•†å“ä¿¡æ¯ç»Ÿä¸€ä¸ºæ ‡å‡†æ ¼å¼ï¼š

```python
# Jump Cal æ•°æ®æ˜ å°„
jump_cal_item = {
    'goodsName': 'è·¯é£æ‰‹åŠ',
    'genre': 'ãƒ•ã‚£ã‚®ãƒ¥ã‚¢', 
    'price': 'Â¥3,500'
}

# å½’ä¸€åŒ–å
normalized_item = {
    'product_hash': 'jump_cal_a1b2c3d4',
    'name': 'è·¯é£æ‰‹åŠ',
    'description': 'ãƒ•ã‚£ã‚®ãƒ¥ã‚¢',
    'price': 'Â¥3,500',
    'source': 'jump_cal'
}
```

### æ™ºèƒ½ç¿»è¯‘

åŸºäºå†…å®¹å“ˆå¸Œçš„å»é‡ç¿»è¯‘ï¼š

```python
# ç›¸åŒå†…å®¹åªç¿»è¯‘ä¸€æ¬¡
text = "è·¯é£æ‰‹åŠ"
product_hash = "jump_cal_a1b2c3d4"

# é¦–æ¬¡ç¿»è¯‘
translation_service.translate(text) â†’ "Luffy Figure"

# åç»­ç›¸åŒå†…å®¹ç›´æ¥ä½¿ç”¨ç¼“å­˜
cache_hit = translation_cache.get(text) â†’ "Luffy Figure"
```

### ç¿»è¯‘ç¼“å­˜

```python
# ç¼“å­˜ç»“æ„
{
    'text_hash': 'md5_hash_of_text',
    'original_text': 'è·¯é£æ‰‹åŠ',
    'translated_text': 'Luffy Figure', 
    'usage_count': 15,
    'created_at': datetime,
    'updated_at': datetime
}
```

## ğŸ“Š ç›‘æ§ä¸ç»Ÿè®¡

### æŸ¥çœ‹ç¿»è¯‘çŠ¶æ€

```bash
# æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
python scripts/translation_service.py --show-stats
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
Translation pending: 25 items
Translated products: 150/200  
Translation cache: 85 entries, 340 total uses
```

### MongoDB æŸ¥è¯¢ç¤ºä¾‹

```javascript
// æŸ¥çœ‹å¾…ç¿»è¯‘é˜Ÿåˆ—
db.translation_pending.find().limit(5)

// æŸ¥çœ‹å·²ç¿»è¯‘äº§å“
db.toys_normalized.find({
    "nameCN": {$exists: true}
}).limit(5)

// ç¼“å­˜å‘½ä¸­ç‡åˆ†æ
db.translation_cache.aggregate([
    {$group: {
        _id: null,
        totalEntries: {$sum: 1},
        totalUsage: {$sum: "$usage_count"},
        avgUsage: {$avg: "$usage_count"}
    }}
])
```

## âš™ï¸ é…ç½®é€‰é¡¹

### çˆ¬è™«é…ç½®

```python
# settings.py
BOT_NAME = 'toy_news'
ROBOTSTXT_OBEY = True
DOWNLOAD_DELAY = 1
RANDOMIZE_DOWNLOAD_DELAY = True

# MongoDB é…ç½®
MONGO_URI = "mongodb://localhost:27017/"
MONGO_DATABASE = "scrapy_items"
```

### ç¿»è¯‘æœåŠ¡é…ç½®

```bash
# å‘½ä»¤è¡Œé€‰é¡¹
--interval 10           # æ£€æŸ¥é—´éš”(ç§’)
--mongo-uri URL        # MongoDB è¿æ¥ä¸²
--mongo-db NAME        # æ•°æ®åº“åç§°  
--show-stats           # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
```

## ğŸ” æ•°æ®å­—æ®µè¯´æ˜

### å½’ä¸€åŒ–å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `product_hash` | String | å•†å“å“ˆå¸ŒID | `jump_cal_a1b2c3d4` |
| `name` | String | å•†å“åç§° | `è·¯é£æ‰‹åŠ` |
| `description` | String | å•†å“æè¿° | `ãƒ•ã‚£ã‚®ãƒ¥ã‚¢` |
| `price` | String | ä»·æ ¼ä¿¡æ¯ | `Â¥3,500` |
| `category` | String | å•†å“åˆ†ç±» | `Figure` |
| `manufacturer` | String | åˆ¶é€ å•† | `ãƒãƒ³ãƒ€ã‚¤` |
| `source` | String | æ•°æ®æº | `jump_cal` |
| `spider_name` | String | çˆ¬è™«åç§° | `jump_cal_op` |

### ç¿»è¯‘å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `nameCN` | String | ä¸­æ–‡å•†å“åç§° |
| `descriptionCN` | String | ä¸­æ–‡å•†å“æè¿° |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¿»è¯‘æœåŠ¡æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥ API Key
   echo $DEEPSEEK_API_KEY
   
   # æ£€æŸ¥ MongoDB è¿æ¥
   mongosh $MONGO_URI
   ```

2. **æ— å¾…ç¿»è¯‘æ•°æ®**
   ```bash
   # æ£€æŸ¥ pipeline é…ç½®
   # ç¡®ä¿åŒ…å« DataNormalizationPipeline
   ```

3. **ç¿»è¯‘ç»“æœä¸ºç©º**
   ```bash
   # æ£€æŸ¥ DeepSeek API é…é¢
   # æŸ¥çœ‹ç¿»è¯‘æœåŠ¡æ—¥å¿—
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ‰¹å¤„ç†ä¼˜åŒ–

```python
# translation_service.py
self.batch_size = 10  # è°ƒæ•´æ‰¹å¤„ç†å¤§å°
self.check_interval = 10  # è°ƒæ•´æ£€æŸ¥é—´éš”
```

### ç¼“å­˜ä¼˜åŒ–

```python
# ç¼“å­˜å‘½ä¸­ç‡ä¼˜åŒ–
# 1. æ–‡æœ¬é¢„å¤„ç†ç»Ÿä¸€
# 2. å»é™¤æ— æ„ä¹‰å­—ç¬¦
# 3. å¤§å°å†™æ ‡å‡†åŒ–
```

### æ•°æ®åº“ä¼˜åŒ–

```javascript
// åˆ›å»ºå¿…è¦ç´¢å¼•
db.toys_normalized.createIndex({product_hash: 1})
db.translation_pending.createIndex({product_hash: 1})
db.translation_cache.createIndex({text_hash: 1})
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [Scrapy æ–‡æ¡£](https://scrapy.org/)
- [MongoDB æ–‡æ¡£](https://docs.mongodb.com/)
- [DeepSeek API](https://platform.deepseek.com/)
